# Implementation Plan: Gemini-Driven Property Data Structuring

**Branch**: `006-gemini-structuring` | **Date**: 2025-11-10 | **Spec**: ./spec.md
**Input**: Feature specification from `/specs/006-gemini-structuring/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Integrate a structuring service that combines brochure PDF text, OCR text, and image metadata, applies normalization and conflict resolution, and invokes Gemini 2.5-Flash to produce a strict JSON schema: project_overview, amenities, connectivity, floor_plans, faqs. Enforce English-only inputs, input cap (≤ 1,000,000 chars), 12s TTL, and privacy‑safe logging (summaries + metrics).

## Technical Context

**Language/Version**: Python 3.11  
**Primary Dependencies**: Flask, Flask-CORS, Flask-SQLAlchemy, google-generativeai, python-dotenv, logging  
**Storage**: SQLite (persist structured JSON and minimal audit logs)  
**Testing**: Manual validation scenarios; JSON schema validation against OpenAPI; endpoint smoke tests  
**Target Platform**: Local Windows dev; containerizable later  
**Project Type**: Web application (backend + existing frontend)  
**Performance Goals**: Typical structuring ≤ 3–4s; hard timeout 12s  
**Constraints**: English-only text; input cap ≤ 1,000,000 chars; no raw LLM content persisted  
**Scale/Scope**: Works across residential/commercial brochures; robust to sparse inputs

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- Simplicity: Single endpoint `/structure-data`; strict schema. PASS
- Intelligence: Uses Gemini 2.5-Flash with combined context. PASS
- Speed: Targets 3–4s typical, 12s max. PASS
- Reliability: Validation, retry once, safe errors. PASS
- Data Privacy & Security: Env-based API key, no raw LLM logs. PASS
- Accessibility & Performance: Backend-only; aligns with goals. PASS
- Observability & Logging: Structured summaries + metrics. PASS

## Project Structure

### Documentation (this feature)

```text
specs/006-gemini-structuring/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   └── openapi.yaml
└── tasks.md  (to be generated by /speckit.tasks)
```

### Source Code (repository root)

```text
backend/
├── routes/
│   ├── upload_routes.py
│   ├── extract_routes.py
│   ├── image_routes.py
│   └── (new) structure_routes.py   # POST /structure-data
├── models/
│   ├── pdf_model.py
│   ├── extracted_text.py
│   ├── extracted_image.py
│   └── (optional) structured_data.py
├── services/
│   └── (new) structuring_service.py # normalization, prompt, validation
└── app.py

frontend/
└── (integration later – consumer of structured JSON)
```

**Structure Decision**: Extend backend with a new route `structure_routes.py` and a service `structuring_service.py`. Keep storage in existing SQLite. No new projects created.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| — | — | — |
